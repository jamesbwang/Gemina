  The purpose of this paper is to find a deterministic pencil beam algorithm that computes , from first principles , the dose in some region of interest when a known heterogeneous terrain is irradiated by known proton beams. The terrain is discretized into slabs perpendicular to the nominal beam direction. Pencil beams ( PBs) are transported through each slab using generalized Fermi-Eyges theory with the correct stopping and scattering powers for each material ( no water-like assumption). At transverse heterogeneities PBs are divided into smaller ones using either redefinition ( all PBs divided) or dynamic splitting ( PBs divided one at a time as needed). Dynamic splitting recurs until the transverse heterogeneity is sufficiently well resolved. After a PB is transported , its dose contribution at the slab exit ( if designated as a measuring plane) is added to each point of interest. The calculation depends solely on accurate descriptions of the terrain and of the incident beams. It does not require measurements such as effective source size and position. These follow from the beam line specifications. The calculation ignores nuclear reactions ( hard scatters) , as do other PB algorithms. Our first comparison with experiment confronts the widely used ` Hong ' algorithm. The second is a simple study of collimator scatter and the third studies collimator scatter under more extreme conditions. All agree well with the high dose region. The latter two agree substantially with collimator scatter and thickness effects , ignored by conventional algorithms. The algorithm gives a good account of the high dose region , including realistic collimator effects. It is equally amenable to passive beam spreading or pencil beam scanning ( PBS). It dispenses with measurements ( commissioning) of beam line properties. In PBS it promises to be faster than conventional algorithms since virtual PBs are generated only as needed. These results justify further work towards a full-fledged therapy dose engine.