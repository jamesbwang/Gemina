  The low-T part of the phase diagram in self-assembling systems is correctly predicted by known versions of density functional theory ( DFT). The high-T part obtained in DFT , however , does not agree with simulations even on the qualitative level. In this work , a new version of DFT for systems with spontaneous inhomogeneities on a mesoscopic length scale is developed. The contribution to the grand thermodynamic potential associated with mesoscopic fluctuations is explicitly taken into account. The expression for this contribution is obtained by methods known from the Brazovskii field theory. Apart from developing the approximate expression for the grand thermodynamic potential that contains the fluctuation contribution and is ready for numerical minimization , we develop a simplified version of the theory valid for weakly ordered phases , i.e. for the high-T part of the phase diagram. The simplified theory is verified by comparison with the results of simulations for a particular version of the short-range attraction long-range repulsion ( SALR) interaction potential. Except for the fact that in our theory the ordered phases are stable at lower T than in simulations , a good agreement for the high-T part of the phase diagram is obtained for the range of density that was considered in simulations. In addition , the equation of state and compressibility isotherms are presented. Finally , the physical interpretation of the fluctuation-contribution to the grand potential is discussed in detail.