  Pedestrian dead reckoning ( PDR) using smart phone-embedded micro-electro-mechanical system ( MEMS) sensors plays a key role in ubiquitous localization indoors and outdoors. However , as a relative localization method , it suffers from the problem of error accumulation which prevents it from long term independent running. Heading estimation error is one of the main location error sources , and therefore , in order to improve the location tracking performance of the PDR method in complex environments , an approach based on robust adaptive Kalman filtering ( RAKF) for estimating accurate headings is proposed. In our approach , outputs from gyroscope , accelerometer , and magnetometer sensors are fused using the solution of Kalman filtering ( KF) that the heading measurements derived from accelerations and magnetic field data are used to correct the states integrated from angular rates. In order to identify and control measurement outliers , a maximum likelihood-type estimator ( M-estimator)- based model is used. Moreover , an adaptive factor is applied to resist the negative effects of state model disturbances. Extensive experiments under static and dynamic conditions were conducted in indoor environments. The experimental results demonstrate the proposed approach provides more accurate heading estimates and supports more robust and dynamic adaptive location tracking , compared with methods based on conventional KF.